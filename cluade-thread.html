<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ: AI ‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÉ‡∏ô‡∏õ‡∏µ 2025 - NewsHub</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Prompt',sans-serif;background:#f5f5f5;color:#292D32}
    .header{background:#292D32;color:#fff;position:sticky;top:0;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .navbar{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem}
    .logo{font-size:1.5rem;font-weight:700;color:#fff;text-decoration:none}
    .nav-menu{display:flex;gap:2rem;align-items:center;list-style:none}
    .nav-menu a{color:#fff;text-decoration:none;font-weight:500;transition:.3s}
    .nav-menu a:hover{color:#FFD700}
    .search-box{display:flex;align-items:center;background:#44484F;border-radius:20px;padding:.5rem 1rem}
    .search-box input{background:none;border:none;color:#fff;outline:none;width:200px}
    .hamburger{display:none;flex-direction:column;gap:4px;cursor:pointer}
    .hamburger span{width:25px;height:3px;background:#fff;border-radius:2px}
    .auth-buttons{display:flex;gap:1rem;align-items:center}
    .btn{padding:.6rem 1.5rem;border-radius:8px;text-decoration:none;font-weight:500;border:none;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
    .btn-login{background:transparent;color:#fff;border:2px solid #fff;border-radius:20px}
    .btn-login:hover{background:#fff;color:#292D32}
    .btn-logout{background:#FF4444;color:#fff;border:2px solid #FF4444;border-radius:20px}
    .btn-logout:hover{background:#E03030}
    .breadcrumb{background:#fff;padding:1rem 2rem;border-bottom:1px solid #e0e0e0}
    .breadcrumb-content{max-width:1400px;margin:0 auto;display:flex;align-items:center;gap:.5rem;font-size:.9rem;color:#666}
    .breadcrumb a{color:#292D32;text-decoration:none}
    .breadcrumb a:hover{color:#FFD700}
    .container{max-width:1400px;margin:2rem auto;padding:0 2rem;display:grid;grid-template-columns:1fr 350px;gap:2rem}
    .thread-header{background:#fff;border-radius:15px;padding:2rem;margin-bottom:1.5rem;box-shadow:0 2px 10px rgba(0,0,0,.05);min-height:200px}
    .back-link{display:inline-flex;align-items:center;gap:.5rem;color:#666;text-decoration:none;margin-bottom:1rem;font-size:.9rem}
    .back-link:hover{color:#292D32}
    .thread-title{font-size:2rem;margin-bottom:1rem;line-height:1.3}
    .thread-meta{display:flex;gap:1.5rem;align-items:center;flex-wrap:wrap;padding:1rem 0;border-top:1px solid #e0e0e0;border-bottom:1px solid #e0e0e0;margin-bottom:1rem}
    .meta-item{display:flex;align-items:center;gap:.3rem;font-size:.9rem;color:#666}
    .avatar-small{width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);display:inline-block;margin-right:.3rem;vertical-align:middle}
    .avatar-comment{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
    .avatar-comment.avatar-2{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%)}
    .badge{display:inline-block;padding:.3rem .8rem;border-radius:12px;font-size:.75rem;font-weight:600}
    .badge-hot{background:#FF6B00;color:#fff}
    .tag{background:#f0f0f0;padding:.4rem 1rem;border-radius:15px;font-size:.85rem;text-decoration:none;color:#292D32}
    .tag:hover{background:#292D32;color:#fff}
    .thread-actions{display:flex;gap:1rem;margin-top:1rem}
    .btn-primary{background:#292D32;color:#fff}
    .btn-outline{background:#fff;color:#292D32;border:2px solid #292D32}
    .article-link{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;text-decoration:none;display:block;transition:.3s}
    .article-link:hover{box-shadow:0 8px 20px rgba(0,0,0,.15);transform:translateY(-3px)}
    .comments-section{background:#fff;border-radius:15px;padding:2rem;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .comments-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid #292D32}
    .sort-options{display:flex;gap:1rem}
    .sort-btn{background:none;border:1px solid #e0e0e0;padding:.5rem 1rem;border-radius:8px;cursor:pointer;font-size:.85rem}
    .sort-btn.active{background:#292D32;color:#fff;border-color:#292D32}
    .comment{padding:1.5rem 0;border-bottom:1px solid #e0e0e0;margin-bottom:0;display:flex;gap:1rem}
    .comment:last-child{border-bottom:none}
    .comment-content{flex:1}
    .comment-header{display:flex;align-items:center;gap:.5rem;margin-bottom:.8rem;font-size:.9rem}
    .comment-author{font-weight:600;color:#292D32}
    .comment-date{color:#666}
    .comment-body{line-height:1.7;color:#333}
    .comment-actions{margin-top:1rem;display:flex;gap:1rem;font-size:.85rem}
    .comment-actions a{color:#666;text-decoration:none;font-weight:500}
    .comment-actions a:hover{color:#292D32}
    .reply-form{background:#f9f9f9;padding:1.5rem;border-radius:12px;margin-top:2rem}
    .form-group{margin-bottom:1rem}
    .form-group textarea{width:100%;padding:1rem;border:1px solid #e0e0e0;border-radius:8px;font-family:'Prompt',sans-serif;resize:vertical;min-height:120px;outline:none;transition:border-color .3s}
    .form-group textarea:focus{border-color:#292D32}
    .form-actions{display:flex;gap:1rem;justify-content:flex-end}
    .sidebar{display:flex;flex-direction:column;gap:1.5rem}
    .sidebar-widget{background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .sidebar-widget h3{font-size:1.1rem;margin-bottom:1rem;padding-bottom:.8rem;border-bottom:2px solid #292D32}
    .related-thread{padding:1rem;border:1px solid #e0e0e0;border-radius:8px;margin-bottom:.8rem;display:block;color:inherit;text-decoration:none;transition:.2s}
    .related-thread:hover{background:#f9f9f9;border-color:#292D32}
    .related-thread-title{font-weight:500;font-size:.9rem;margin-bottom:.5rem}
    .related-thread-stats{font-size:.8rem;color:#666}
    .stats-box{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
    .stat-item{text-align:center;padding:1rem;background:#f9f9f9;border-radius:8px}
    .stat-number{font-size:1.5rem;font-weight:700;color:#292D32;margin-bottom:.3rem}
    .stat-label{font-size:.85rem;color:#666}
    @media(max-width:968px){
      .container{grid-template-columns:1fr}
      .sidebar{order:2} main{order:1}
      .thread-title{font-size:1.5rem}
      .nav-menu{display:none;flex-direction:column;position:absolute;top:60px;left:0;right:0;background:#292D32;padding:1rem}
      .hamburger{display:flex}
      .search-box{display:none}
    }
    /* replies */
    .replies-container{margin-top:1rem;padding-left:2rem;border-left:3px solid #e0e0e0;display:none}
    .reply-comment{display:flex;gap:.8rem;padding:.8rem;background:#f9f9f9;border-radius:8px;margin-bottom:.5rem}
    .reply-avatar{width:30px;height:30px;border-radius:50%;background:#ccc;flex-shrink:0}
    .reply-content{font-size:.9rem;width:100%}
    .reply-header{font-weight:600;color:#333}
    .reply-body{color:#555;padding:.3rem 0}
    .reply-date{font-size:.8rem;color:#888}
    .reply-form-small{display:none;gap:10px;margin-top:1rem;margin-left:50px}
    .reply-form-small input{flex:1;padding:.5rem;border:1px solid #ccc;border-radius:4px}
    .reply-form-small button{padding:.5rem .8rem;font-size:.8rem}
    .view-replies-btn{font-size:.85rem;font-weight:600;color:#292D32;text-decoration:none;margin-top:1rem;display:inline-block;cursor:pointer}
    .view-replies-btn:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header class="header">
    <nav class="navbar">
      <a href="index.html" class="logo">üì∞üí¨ NewsHub</a>
      <ul class="nav-menu">
        <li><a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
        <li><a href="index.html#forum">‡∏ü‡∏≠‡∏£‡∏±‡πà‡∏°</a></li>
      </ul>
      <div class="search-box">
        <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."><span>üîç</span>
      </div>
      <div class="auth-buttons" id="auth-container">
        <a href="login.html" class="btn btn-login">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
      </div>
      <div class="hamburger"><span></span><span></span><span></span></div>
    </nav>
  </header>

  <div class="breadcrumb">
    <div class="breadcrumb-content" id="breadcrumb-container">
      <a href="index.html">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a><span>‚Ä∫</span>
      <a href="index.html#forum">‡∏ü‡∏≠‡∏£‡∏±‡πà‡∏°</a><span>‚Ä∫</span>
      <a href="#">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</a><span>‚Ä∫</span><span>AI ‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏á‡∏Å‡∏≤‡∏£...</span>
    </div>
  </div>

  <div class="container">
    <main>
      <div class="thread-header" id="thread-header-container">
        <a href="index.html#forum" class="back-link">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ü‡∏≠‡∏£‡∏±‡πà‡∏°</a>
        <h1 class="thread-title">üöÄ AI ‡∏õ‡∏è‡∏¥‡∏ß‡∏±‡∏ï‡∏¥‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡πÉ‡∏ô‡∏õ‡∏µ 2025</h1>
        <div class="thread-meta">
          <span class="meta-item"><span class="avatar-small"></span>‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÇ‡∏î‡∏¢ <strong>TechSource</strong></span>
          <span class="meta-item">üìÖ 10 ‡∏û.‡∏¢. 2025</span>
          <span class="meta-item"><span class="badge badge-hot">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</span></span>
        </div>
        <p style="margin-top:1rem;line-height:1.7">‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ñ‡∏∂‡∏á‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á AI ... (Mockup)</p>
        <div class="thread-actions">
          <a href="#" class="tag">AI</a><a href="#" class="tag">Machine Learning</a><a href="#" class="tag">2025</a>
        </div>
      </div>

      <a href="#" class="article-link" id="article-link-container">
        <div class="article-link-content">
          <h3>üîó ‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</h3>
          <p>‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏à‡∏≤‡∏Å: "The AI Revolution..." (Mockup)</p>
        </div>
      </a>

      <div class="comments-section">
        <div class="comments-header">
          <h2 id="comments-title">üí¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (3)</h2>
          <div class="sort-options">
            <button class="sort-btn active">‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
            <button class="sort-btn">‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</button>
            <button class="sort-btn">‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
          </div>
        </div>

        <div id="comments-list-container">
          <div id="real-posts-container"><p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô...</p></div>

          <!-- MOCKUP STATIC -->
          <div class="comment">
            <div class="avatar-comment"></div>
            <div class="comment-content">
              <div class="comment-header"><span class="comment-author">CloudGuru</span><span class="comment-date">‚Ä¢ (Mockup) 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</span></div>
              <div class="comment-body"><p>‡πÄ‡∏´‡πá‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Serverless AI...</p></div>
              <div class="comment-actions">
                <a href="#">üëç 5 ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</a><a href="#" class="reply-btn-mockup">‚Ü™Ô∏è ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</a>
              </div>
              <div class="replies-container" style="display:block">
                <div class="reply-comment">
                  <div class="reply-avatar"></div>
                  <div class="reply-content">
                    <span class="reply-header">ReplyBot</span>
                    <div class="reply-body">This is a mockup reply.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="comment">
            <div class="avatar-comment avatar-2"></div>
            <div class="comment-content">
              <div class="comment-header"><span class="comment-author">DevMan</span><span class="comment-date">‚Ä¢ (Mockup) 45 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</span></div>
              <div class="comment-body"><p>‡∏ú‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö...</p></div>
              <div class="comment-actions">
                <a href="#">üëç 2 ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</a><a href="#" class="reply-btn-mockup">‚Ü™Ô∏è ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</a>
              </div>
            </div>
          </div>
          <!-- /MOCKUP STATIC -->
        </div>

        <div class="reply-form" id="reply-form-container" style="display:none">
          <h3 style="margin-bottom:1rem">‚úçÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h3>
          <div class="form-group">
            <textarea id="reply-textarea" placeholder="‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."></textarea>
          </div>
          <div class="form-actions">
            <button class="btn btn-outline" id="cancel-main-post">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-primary" id="submit-reply-btn">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</button>
          </div>
        </div>

        <div id="login-prompt-container" style="text-align:center;margin-top:2rem;background:#f9f9f9;padding:2rem;border-radius:12px;display:none">
          <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ <a href="login.html" style="color:#292D32">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</h3>
        </div>
      </div>
    </main>

    <aside class="sidebar">
      <div class="sidebar-widget">
        <h3>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ</h3>
        <div class="stats-box" id="thread-stats-container">
          <div class="stat-item"><div class="stat-number" id="stats-replies">2</div><div class="stat-label">‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</div></div>
          <div class="stat-item"><div class="stat-number">...</div><div class="stat-label">‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Ñ‡∏∏‡∏¢</div></div>
          <div class="stat-item"><div class="stat-number">...</div><div class="stat-label">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°</div></div>
          <div class="stat-item"><div class="stat-number">...</div><div class="stat-label">‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</div></div>
        </div>
      </div>
      <div class="sidebar-widget">
        <h3>üî• ‡∏Å‡∏£‡∏∞‡∏ó‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</h3>
        <div id="related-threads-container">
          <a href="#" class="related-thread"><div class="related-thread-title">‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏Ç‡∏≠‡∏á GPT-5 ... (Mockup)</div></a>
          <a href="#" class="related-thread"><div class="related-thread-title">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö AWS Bedrock ... (Mockup)</div></a>
        </div>
      </div>
    </aside>
  </div>

  <script defer>
    /* ========= CONFIG ========= */
    // ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤ (index/login/register)
    const API_URL = 'https://tae6m8cy06.execute-api.us-east-1.amazonaws.com/prod';
    const TOKEN_KEY = 'forum_token';
    const EMAIL_KEY = 'user_email';

    /* ======= Utils ======= */
    function parseJwt(token){
      try{
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(c=>'%' + ('00'+c.charCodeAt(0).toString(16)).slice(-2)).join(''));
        return JSON.parse(jsonPayload);
      }catch(e){ console.warn('parseJwt error', e); return null; }
    }

    function getAuthState(){
      const token = localStorage.getItem(TOKEN_KEY);
      const emailFromStorage = localStorage.getItem(EMAIL_KEY) || '';
      if(!token) return {loggedIn:false};

      const payload = parseJwt(token);
      if (payload?.exp && (payload.exp*1000) < Date.now()){
        return {loggedIn:false, reason:'expired'};
      }
      const email = payload?.email || emailFromStorage || '';
      return {loggedIn:true, email, token};
    }

    function renderAuth(){
      const authC = document.getElementById('auth-container');
      const replyForm = document.getElementById('reply-form-container');
      const loginPrompt = document.getElementById('login-prompt-container');

      const state = getAuthState();
      if(state.loggedIn){
        authC.innerHTML = `
          <span style="color:#fff;align-self:center">${state.email || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ'}</span>
          <button id="btn-logout" class="btn btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        `;
        document.getElementById('btn-logout').onclick=()=>{
          localStorage.removeItem(TOKEN_KEY);
          localStorage.removeItem(EMAIL_KEY);
          location.reload();
        };
        replyForm.style.display='block';
        loginPrompt.style.display='none';
      }else{
        authC.innerHTML = '<a href="login.html" class="btn btn-login">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>';
        replyForm.style.display='none';
        loginPrompt.style.display='block';
      }
    }

    async function unwrapApiJson(response){
      if(!response.ok){
        let t=''; try{ t=await response.text(); }catch{}
        throw new Error(`HTTP ${response.status} ${t}`.trim());
      }
      let outer; try{ outer = await response.json(); }catch{ throw new Error('Invalid JSON from API'); }

      if (Array.isArray(outer)) return outer;
      if (outer && typeof outer==='object' && 'body' in outer){
        const b = outer.body;
        if (typeof b==='string' && b.trim()!==''){ try{ return JSON.parse(b); }catch{ return b; } }
        if (Array.isArray(b)) return b;
        if (typeof b==='object' && b!==null) return b;
        return [];
      }
      if (Array.isArray(outer?.items)) return outer.items;
      if (Array.isArray(outer?.data)) return outer.data;
      if (Array.isArray(outer?.posts)) return outer.posts;
      return outer;
    }

    /* ======= API Calls ======= */
    async function fetchComments(){
      const realC = document.getElementById('real-posts-container');
      const commentsTitle = document.getElementById('comments-title');
      const statsReplies = document.getElementById('stats-replies');
      const mockupCount = document.querySelectorAll('#comments-list-container > .comment').length;

      realC.innerHTML = '<p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô...</p>';

      try{
        const resp = await fetch(`${API_URL}/posts`);
        const data = await unwrapApiJson(resp);
        const posts = Array.isArray(data) ? data
                    : Array.isArray(data?.posts) ? data.posts
                    : Array.isArray(data?.items) ? data.items : [];

        commentsTitle.innerText = `üí¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (${posts.length + mockupCount})`;
        statsReplies.innerText = posts.length + mockupCount;
        realC.innerHTML = '';

        posts.forEach(post=>{
          const author = (post.authorEmail || 'anonymous').split('@')[0];
          const created = post.createdAt ? new Date(post.createdAt) : new Date();
          const postDate = created.toString()!=='Invalid Date' ? created.toLocaleString('th-TH') : '';
          const textHtml = (post.commentText || '').toString().replace(/\n/g,'<br>');

          const html = `
            <div class="comment">
              <div class="avatar-comment"></div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-author">${author}</span>
                  <span class="comment-date">‚Ä¢ ${postDate}</span>
                </div>
                <div class="comment-body"><p>${textHtml}</p></div>
                <div class="comment-actions">
                  <a href="#">üëç ‡∏ñ‡∏π‡∏Å‡πÉ‡∏à</a>
                  <a href="#" class="toggle-reply-form-btn" data-post-id="${post.postId}">‚Ü™Ô∏è ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</a>
                </div>
                <a href="#" class="view-replies-btn" data-post-id="${post.postId}">‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</a>
                <div class="replies-container" id="replies-for-${post.postId}"></div>
                <div class="reply-form-small" id="reply-form-for-${post.postId}">
                  <input type="text" id="reply-input-${post.postId}" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö...">
                  <button class="post-reply-btn" data-post-id="${post.postId}">‡∏™‡πà‡∏á</button>
                </div>
              </div>
            </div>`;
          realC.insertAdjacentHTML('beforeend', html);
        });

      }catch(err){
        console.error('Fetch comments error:', err);
        realC.innerHTML = `<p style="color:red">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô: ${err.message}</p>`;
      }
    }

    async function fetchReplies(postId){
      const c = document.getElementById(`replies-for-${postId}`);
      if(!c) return;
      c.style.display='block';
      c.innerHTML = '<small>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö...</small>';
      try{
        const resp = await fetch(`${API_URL}/comments?postId=${encodeURIComponent(postId)}`);
        const data = await unwrapApiJson(resp);
        const replies = Array.isArray(data) ? data
                      : Array.isArray(data?.items) ? data.items
                      : Array.isArray(data?.comments) ? data.comments : [];
        c.innerHTML = '';
        if(replies.length===0){ c.innerHTML = '<small>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</small>'; return; }

        replies.forEach(r=>{
          const author = (r.authorEmail || 'anonymous').split('@')[0];
          const created = r.createdAt ? new Date(r.createdAt) : new Date();
          const d = created.toString()!=='Invalid Date' ? created.toLocaleString('th-TH') : '';
          c.insertAdjacentHTML('beforeend', `
            <div class="reply-comment">
              <div class="reply-avatar"></div>
              <div class="reply-content">
                <span class="reply-header">${author}</span>
                <div class="reply-body">${(r.commentText||'').toString()}</div>
                <div class="reply-date">${d}</div>
              </div>
            </div>`);
        });
      }catch(err){
        console.error('Error fetching replies:', err);
        c.innerHTML = `<small style="color:red">Error loading replies: ${err.message}</small>`;
      }
    }

    async function postReply(postId, commentText){
      const state = getAuthState();
      if(!state.loggedIn){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
      const btn = document.querySelector(`.post-reply-btn[data-post-id="${postId}"]`);
      if(btn) btn.disabled = true;
      try{
        const resp = await fetch(`${API_URL}/comments`,{
          method:'POST',
          headers:{'Content-Type':'application/json','Authorization':'Bearer '+state.token},
          body:JSON.stringify({postId, commentText})
        });
        if(!resp.ok){
          let msg=''; try{ msg=(await resp.json()).message; }catch{}
          throw new Error(msg || `HTTP ${resp.status}`);
        }
        document.getElementById(`reply-input-${postId}`).value='';
        document.getElementById(`reply-form-for-${postId}`).style.display='flex';
        await fetchReplies(postId);
      }catch(err){
        console.error('Error posting reply:', err);
        alert('‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message);
      }finally{ if(btn) btn.disabled=false; }
    }

    /* ======= UI & Events ======= */
    document.addEventListener('DOMContentLoaded', async ()=>{
      // mobile menu
      const hamburger = document.querySelector('.hamburger');
      const navMenu = document.querySelector('.nav-menu');
      hamburger.addEventListener('click',()=>{
        if (navMenu.style.display==='flex'){ navMenu.style.display='none'; }
        else{
          navMenu.style.display='flex';
          navMenu.style.flexDirection='column';
          navMenu.style.position='absolute';
          navMenu.style.top='60px'; navMenu.style.left='0'; navMenu.style.right='0';
          navMenu.style.background='#292D32'; navMenu.style.padding='1rem'; navMenu.style.zIndex='999';
        }
      });

      renderAuth();
      await fetchComments();

      // main post
      const postBtn = document.getElementById('submit-reply-btn');
      const cancelBtn = document.getElementById('cancel-main-post');
      const textarea = document.getElementById('reply-textarea');

      cancelBtn.onclick = ()=> textarea.value='';

      if(postBtn){
        postBtn.addEventListener('click', async ()=>{
          const state = getAuthState();
          if(!state.loggedIn){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå'); location.href='login.html'; return; }
          if ((textarea.value||'').trim()===''){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°'); return; }

          postBtn.innerText='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå...'; postBtn.disabled=true;
          try{
            const resp = await fetch(`${API_URL}/posts`,{
              method:'POST',
              headers:{'Content-Type':'application/json','Authorization':'Bearer '+state.token},
              body:JSON.stringify({ commentText: textarea.value })
            });
            if(!resp.ok){
              let msg=''; try{ msg=(await resp.json()).message; }catch{}
              throw new Error(msg || `HTTP ${resp.status}`);
            }
            alert('‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            textarea.value='';
            await fetchComments();
          }catch(err){
            console.error(err);
            alert('‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+err.message);
          }finally{
            postBtn.innerText='‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô'; postBtn.disabled=false;
          }
        });
      }

      // delegation
      const list = document.getElementById('comments-list-container');
      list.addEventListener('click', (e)=>{
        const t = e.target;

        if (t.classList.contains('toggle-reply-form-btn')){
          e.preventDefault();
          const state = getAuthState(); if(!state.loggedIn){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö'); return; }
          const id = t.dataset.postId;
          const form = document.getElementById(`reply-form-for-${id}`);
          form.style.display = (form.style.display==='flex') ? 'none' : 'flex';
        }

        if (t.classList.contains('view-replies-btn')){
          e.preventDefault();
          const id = t.dataset.postId;
          const box = document.getElementById(`replies-for-${id}`);
          if (box.dataset.loaded!=='true'){ fetchReplies(id); box.dataset.loaded='true'; box.style.display='block'; }
          else{ box.style.display = (box.style.display==='block') ? 'none' : 'block'; }
        }

        if (t.classList.contains('post-reply-btn')){
          e.preventDefault();
          const id = t.dataset.postId;
          const input = document.getElementById(`reply-input-${id}`);
          const text = input.value;
          if ((text||'').trim()) postReply(id,text);
          else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö');
        }
      });
    });
  </script>
</body>
</html>
